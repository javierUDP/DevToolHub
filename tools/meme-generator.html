<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Memes - DevTools+</title>
    
    <!-- Dependencias -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

    <!-- Ads y Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1428468963113931" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XM139X80BX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XM139X80BX');
    </script>

    <style>
        #meme-canvas {
            border: 2px dashed #ccc;
            margin: 20px auto;
            max-width: 600px;
        }
        .meme-controls {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        .text-input-group {
            position: relative;
            margin: 15px 0;
        }
        .color-picker {
            width: 40px;
            height: 40px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="row">
            <!-- Anuncio Lateral -->
            <div class="col-md-3 mb-4">
                <div class="sticky-top" style="top: 20px;">
                    <ins class="adsbygoogle"
                        style="display:block"
                        data-ad-client="ca-pub-1428468963113931"
                        data-ad-slot="7259870540"
                        data-ad-format="auto"
                        data-full-width-responsive="true"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>
            </div>

            <!-- Herramienta Principal -->
            <div class="col-md-9">
                <div class="p-4 bg-white rounded shadow">
                    <h1 class="mb-4">üé® Creador de Memes</h1>
                    <a href="../index.html" class="btn btn-outline-secondary mb-4">‚Üê Volver al inicio</a>

                    <div class="meme-controls">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="file" id="image-upload" class="form-control" accept="image/*">
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-primary w-100" onclick="addSampleTemplate()">Usar Plantilla</button>
                            </div>
                        </div>

                        <div class="text-input-group">
                            <input type="text" id="top-text" class="form-control" placeholder="Texto superior...">
                            <input type="color" id="top-color" class="color-picker" value="#ffffff">
                        </div>

                        <div class="text-input-group">
                            <input type="text" id="bottom-text" class="form-control" placeholder="Texto inferior...">
                            <input type="color" id="bottom-color" class="color-picker" value="#ffffff">
                        </div>

                        <div class="text-center">
                            <button class="btn btn-success" onclick="downloadMeme()">‚¨áÔ∏è Descargar Meme</button>
                        </div>
                    </div>

                    <canvas id="meme-canvas" width="600" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const canvas = new fabric.Canvas('meme-canvas');
        let currentImage = null;

        // Subir imagen
        document.getElementById('image-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                fabric.Image.fromURL(event.target.result, function(img) {
                    if(currentImage) canvas.remove(currentImage);
                    currentImage = img.scaleToWidth(600);
                    canvas.add(currentImage);
                    canvas.renderAll();
                });
            };
            reader.readAsDataURL(file);
        });

        // A√±adir texto
        function addText(text, color, position) {
            const textObj = new fabric.Text(text, {
                left: position === 'top' ? 50 : 50,
                top: position === 'top' ? 20 : 360,
                fontSize: 40,
                fontFamily: 'Impact',
                fill: color,
                stroke: '#000',
                strokeWidth: 2
            });
            canvas.add(textObj);
        }

        // Eventos en tiempo real
        document.getElementById('top-text').addEventListener('input', function() {
            canvas.getObjects('text')[0]?.set({ text: this.value });
            canvas.renderAll();
        });

        document.getElementById('bottom-text').addEventListener('input', function() {
            canvas.getObjects('text')[1]?.set({ text: this.value });
            canvas.renderAll();
        });

        // Descargar meme
        function downloadMeme() {
            const dataURL = canvas.toDataURL({
                format: 'png',
                quality: 1.0
            });
            
            const link = document.createElement('a');
            link.download = 'meme-devtools-plus.png';
            link.href = dataURL;
            link.click();
            
            gtag('event', 'download_meme', {
                'event_category': 'creative_tools',
                'event_label': 'Meme descargado'
            });
        }

        // Plantilla de ejemplo
        function addSampleTemplate() {
            fabric.Image.fromURL('https://i.imgur.com/8fuTRW0.jpg', function(img) {
                if(currentImage) canvas.remove(currentImage);
                currentImage = img.scaleToWidth(600);
                canvas.add(currentImage);
                
                addText('Texto Superior', '#ffffff', 'top');
                addText('Texto Inferior', '#ffffff', 'bottom');
                canvas.renderAll();
            });
        }
    </script>
</body>
</html>